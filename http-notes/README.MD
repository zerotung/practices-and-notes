# 了解Web及网络基础

## 网络基础TCP/IP

### TCP/IP的分层管理

1. 应用层

   决定了向用户提供应用服务时通信的活动。比如FTP，DNS，HTTP协议

2. 传输层

   对应用层提供处于网络连接中的两台计算机之间的数据传输。两个性质不同的协议：

   1. TCP(Transmission Control Protocol，传输控制协议)
   2. UDP(User Data Protocol，用户数据报协议)

3. 网络层

   用于处理在网络上流动的数据包，规定了通过怎样的路径到达对方计算机。

4. 链路层

   用于处理连接网络的硬件部分。包括控制操作系统，硬件设备驱动，网卡(NIC)等。

## 与HTTP关系密切的协议：IP、TCP和DNS

### 负责传输的IP协议

按层次分，IP(Internet Protocol)网际协议位于网络层。

要确保数据包传送到对方，需要满足各类条件。其中两个重要条件是IP地址和MAC地址(Media Access Control Address)

IP地址指明了节点被分配到的地址，MAC地址是指网卡所属的固定地址。IP地址可以和MAC地址进行匹配。

**使用ARP协议凭借MAC地址进行通信**

IP间的通信依赖MAC地址。在中转时，利用下一站中转设备的MAC地址来搜索下一个中转目标。这时采用ARP协议(Address Resolution Protocol，解析地址协议)，根据通信方的IP地址就能反查出对应的MAC地址。

### 确保可靠性的TCP协议

按层次分，TCP位于传输层。

TCP协议为了更容易传送大数据才把数据分割，而且TCP协议能够确认数据最终是否送达到对方。

**确保数据能到达目标**

为了准确无误地将数据送达目标处，TCP协议采用了三次握手(three-way handshaking)策略。握手过程采用了TCP的标志——SYN(synchronize)和ACK(acknowledgement)。

发送端首先发送一个带SYN标志的数据包给对方。接受端收到后，回传一个带有SYN/ACK标志的数据包表示传达确认。最后发送端再回传一个带ACK标志的数据包，代表“握手”结束。

### 负责域名解析的DNS服务

和HTTP协议一样位于应用层。提供通过域名查IP，或逆向从IP反查域名的服务。

# 简单的HTTP协议

## 告知服务器意图的HTTP方法

1. GET：获取资源

   用于请求访问已被URI识别的资源。指定资源经服务器端解析后返回响应内容。

2. POST：传输实体主体

   POST的主要目的并不是获取响应的主体内容，一般用于修改服务器端数据。

3. PUT：传输文件

   像FTP协议的文件上传一样，要求在请求报文的主体中包含文件内容，然后保存到请求URI指定的位置。

   鉴于HTTP/1.1的PUT方法自身不带验证机制，任何人都可以上传文件，存在安全问题，因此一般Web网站不使用该种方法。配合Web应用程序的验证机制，或架构设计采用REST(Representational State Transfer，表征状态转移)标准的同类Web网站，就可能开放。

4. HEAD：获得报文首部

   和GET方式一样，但不返回报文主体部分。用于确认URI的有效性及资源更新的日期时间等。

5. DELETE：删除文件

   与PUT类似，按请求URI删除指定的资源。同样存在安全性问题。

6. OPTIONS：询问支持的方法

   用来查询针对请求URI指定的资源支持的方法。

   ```http
   HTTP/1.1 200 OK
   Allow: GET, POST, HEAD, OPTIONS
   ```

7. TRACE：追踪路径

   让Web服务器端将之前的请求通信环回给客户端的方法。

   发送请求时，在`Max-ForWards`首部字段中填入数值，每经过一个服务器端就减1，当刚好减到0时，就停止继续传输，最后接收到请求的服务器端则返回状态码`200 OK`的响应。用来确认连接源目标服务器过程中发生的一系列操作。（不常用）

8. CONNECT：要求用隧道协议连接代理

   要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL(Secure Sockets Layer，安全套接层)和TLS(Transport Layer Security，传输层安全)协议把通信内容加密后经网络隧道传输。

   CONNECT方法的格式： `CONNECT 代理服务器名:端口号 HTTP版本`

   ```http
   CONNECT proxy.hackr.jp:8080 HTTP/1.1
   Host: proxy.hackr.jp
   -------
   HTTP/1.1 200 OK
   ```

## 持久连接节省通信量

### 持久连接

持久连接，也称HTTP keep-alive或HTTP connection reuse方法。持久连接的特点是，只要任意一端没有明确提出断开连接，则保持TCP连接状态。

### 管线化

持久连接使得多数请求以管线化(pipelining)方式发送成为可能。管线化技术可以不用等待响应亦可直接发送下一个请求。

## 使用Cookie的状态管理

Cookie会根据从服务器端发送的响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie。当下次客户端往该服务器发送请求时，客户端会自动在请求报文中加入Cookie值后发送出去。服务器端发现客户端发送过来的Cookie后，会去检查客户端来源，对比服务器上的记录，最后得到之前的状态信息。

# HTTP报文内的HTTP信息

## HTTP报文

用于HTTP协议交互的信息被称为HTTP报文。分为请求报文和响应报文。HTTP报文本身是由多行数据构成的字符串文本（用CR+LF换行）。HTTP报文大致可分为报文首部和报文主体两块，用空行划分。通常不一定要有报文主体。

## 报文结构

报文首部（请求/状态行，请求/响应首部字段，通用首部字段，实体首部字段，其他），空行(CR+LF)，报文主体

## 编码提升传输速率

### 报文主体和实体主体的差异

- 报文（message）

  是HTTP通信中的基本单位，由8位组字节流组成，通过HTTP通信传输。

- 实体（entity）

  作为请求或响应的有效载荷数据（补充项）被传输，其内容由实体首部和实体主体组成。

HTTP报文的主体用于传输请求或响应的实体主体。通常，报文主体等于实体主体。只有在传输中进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异

### 压缩传输的内容编码

内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。常用的内容编码有已下几种：

- gzip (GNU zip)
- compress (UNIX系统的标准压缩)
- deflate (zlib)
- identity (不进行编码)

### 分割发送的分块传输编码

在传输大容量数据时，通过把数据分割成多块，能够让浏览器逐步显示页面。这种把实体主体分块的功能称为分块传输编码(Chunked Transfer Coding)。

分块传输编码会将实体主体分成多个部分（块）。每一块都会用十六进制来标记块的大小，而实体主体的最后一块会用`0(CR+LF)`来标记。

## 发送多种数据的多部分对象集合

发送邮件时，我们可以在邮件里写入文字并添加多份附件。这是因为采用了MIME(Multipurpose Internet Mail Extensions，多用途因特网邮件扩展)机制。